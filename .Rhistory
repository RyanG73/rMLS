df <- df[-1,]
df$Player <- stringi::stri_trans_general(df$Player, "Latin-ASCII")
pg <- xml2::read_html(URL)
all <- rvest::html_attr(rvest::html_nodes(pg, "a"), "href")
all <- tibble::as_tibble(all)
all <- all %>%
dplyr::filter(stringr::str_detect(value, '^/en/players/')) %>%
dplyr::filter(nchar(value) >= 13) %>%
dplyr::filter(stringr::str_detect(value, 'country',negate = T)) %>%
dplyr::filter(stringr::str_detect(value, 'matchlogs',negate = T))
output <- plyr::count(all[1:100,], vars = "value") %>%
dplyr::mutate(player_name = substr(value,22,nchar(value))) %>%
dplyr::mutate(player_name = stringr::str_replace_all(player_name, "-", " ")) %>%
dplyr::mutate(player_id = substr(value,13,20))
output <- dplyr::left_join(dplyr::select(df,Player),dplyr::select(output,player_name,player_id),by=c('Player'="player_name"))
output$value <- NULL
output$freq <- NULL
output$season <- s
output$squad <- team
output <- na.omit(output)
total <- dplyr::bind_rows(total,output)
Sys.sleep(1)
}
}
View(total)
rosters <- function(start_season=1996,end_season=2020,teamid=NULL){
print("Depending on the number of teams/years, this function take a moment to run - we dont want to overload the fbref server!")
print("If you enjoy this content, please consider creating an fbref account to support them")
total <- tibble::tibble()
team_table <- rMLS::team_info %>% dplyr::filter(team_est_year <= 2021)
team_table$team_est_year <- ifelse(team_table$team_est_year < start_season,start_season,team_table$team_est_year)
if (!is.null(teamid)) {
team_table <- team_table %>% filter(team_id == teamid)
}
for(i in 1:nrow(team_table)){
id <- team_table[[i,3]]
team <- team_table[[i,2]]
start_season <- team_table[[i,17]]
for(s in start_season:end_season){
URL <- paste0("https://fbref.com/en/squads/",id,"/",s,"/")
html_doc <- URL %>% xml2::read_html()
table <- html_doc %>% rvest::html_nodes("table")
my_string <- substr(paste(table[1], collapse=', ' ), 1, 100)
my_string <- gsub("[[:punct:]]|[[:digit:]]|^http:\\/\\/.*|^https:\\/\\/.*","",my_string)
if(grepl('standard', my_string, fixed = TRUE)){table <- table[[1]]}else{break}
#try(table <- table[[1]],next)
table1 <- table %>% rvest::html_table()
df <- as.data.frame(table1)
names(df) <- paste0(names(df), df[1, ])
names(df) <- stringr::str_replace_all(names(df), "%", "pct")
names(df) <- gsub("[[:punct:]]|[[:digit:]]|^http:\\/\\/.*|^https:\\/\\/.*","",names(df))
df <- df[-1,]
df$Player <- stringi::stri_trans_general(df$Player, "Latin-ASCII")
pg <- xml2::read_html(URL)
all <- rvest::html_attr(rvest::html_nodes(pg, "a"), "href")
all <- tibble::as_tibble(all)
all <- all %>%
dplyr::filter(stringr::str_detect(value, '^/en/players/')) %>%
dplyr::filter(nchar(value) >= 13) %>%
dplyr::filter(stringr::str_detect(value, 'country',negate = T)) %>%
dplyr::filter(stringr::str_detect(value, 'matchlogs',negate = T))
output <- plyr::count(all[1:100,], vars = "value") %>%
dplyr::mutate(player_name = substr(value,22,nchar(value))) %>%
dplyr::mutate(player_name = stringr::str_replace_all(player_name, "-", " ")) %>%
dplyr::mutate(player_id = substr(value,13,20))
output <- dplyr::left_join(dplyr::select(df,Player),dplyr::select(output,player_name,player_id),by=c('Player'="player_name"))
output$value <- NULL
output$freq <- NULL
output$season <- s
output$squad <- team
output <- na.omit(output)
total <- dplyr::bind_rows(total,output)
Sys.sleep(1)
}
}
return(total)
}
test <- rosters(2021,2021)
View(test)
library(devtools)
install_github("ryang73/rMLS")
hou <- rMLS::rosters(start_season = 2020,end_season = 2020)
View(hou)
hou <- rMLS::rosters(start_season = 2021,end_season = 2021)
View(hou)
rMLS::fte_matches(2021)
data <- rMLS::fte_matches(2021)
View(data)
data <- rMLS::fte_rankings()
View(data)
box <- rMLS::fixtures(start_season = 2021,end_season = 2021)
opener <- rMLS::box_scores(box,row=1)
View(opener)
library(tidyverse)
library(rMLS)
rosters <- rMLS::rosters(start_season = 2020,end_season = 2021)
View(rosters)
library(devtools)
install_github("ryang73/rMLS")
library(rMLS)
rMLS::current_odds
odds <- rMLS::current_odds
View(odds)
??current_odds
help(rMLS::current_odds)
table <- read.table('http://s3.amazonaws.com/mlspa/2021-Spring-Summer-Salary-List_210513_132332.csv?mtime=20210513132332')
table <- read.table('http://s3.amazonaws.com/mlspa/2021-Spring-Summer-Salary-List_210513_132332.csv?mtime=20210513132332',sep=",'")
table <- read.table('http://s3.amazonaws.com/mlspa/2021-Spring-Summer-Salary-List_210513_132332.csv?mtime=20210513132332',sep=",")
table <- read.csv('http://s3.amazonaws.com/mlspa/2021-Spring-Summer-Salary-List_210513_132332.csv?mtime=20210513132332',sep=",")
View(table)
load("~/rProjects/rMLS/data/salaries.RData")
View(salaries)
salaries21 <- read.csv('http://s3.amazonaws.com/mlspa/2021-Spring-Summer-Salary-List_210513_132332.csv?mtime=20210513132332',sep=",")
###########
names(salaries21)
names(salaries21)<-tolower(names(salaries21))
salaries21 <- salaries21 %>% rename_with( ~ tolower(gsub("_", "", .x, fixed = TRUE)))
library(tidyverse)
salaries21 <- salaries21 %>% rename_with( ~ tolower(gsub("_", "", .x, fixed = TRUE)))
salaries21$clubgrouped <- NULL
salaries21$totalcompensation
View(salaries21)
names(salaries)
names(salaries21) <- c('lastname','firstname','club','position','basesalary','totalcompensation')
salaries21$totalcompensation
salaries21$totalcompensation <- as.numeric(gsub('[$,]', '', salaries21$totalcompensation))
salaries21$basesalary <- as.numeric(gsub('[$,]', '', salaries21$basesalary))
unique(salaries$position)
oldValue <- c("F","M","GK","F-M","D","D-M","F/M","M-F","M-D","M/F","D/F","D/M","M/D","MF","D-F","F-D")
newValue <- c("Forward","Midfielder","Goalkeeper","Forward","Defender","Defender","Forward","Midfielder","Midfielder","Midfielder","Defender","Defender","Midfielder","Midfielder","Defender","Forward")
unique(salaries21$position)
oldValue <- c("F","M","GK","F-M","D","D-M","F/M","M-F","M-D","M/F","D/F","D/M","M/D","MF","D-F","F-D")
newValue <- c("Forward","Midfielder","Goalkeeper","Forward","Defender","Defender","Forward","Midfielder","Midfielder","Midfielder","Defender","Defender","Midfielder","Midfielder","Defender","Forward")
salaries21$position <- mapvalues(salaries21$position, oldValue, newValue)
salaries21$position <- plyr::mapvalues(salaries21$position, oldValue, newValue)
oldValue <- c("M","D","F","D-M","M-F","GK","F-M","M-D")
newValue <- c("Midfielder","Defender","Forward","Defender","Midfielder","Goalkeeper","Forward","Midfielder")
salaries21$position <- plyr::mapvalues(salaries21$position, oldValue, newValue)
###########
salaries21 <- read.csv('http://s3.amazonaws.com/mlspa/2021-Spring-Summer-Salary-List_210513_132332.csv?mtime=20210513132332',sep=",")
names(salaries21)
names(salaries21)<-tolower(names(salaries21))
names(salaries21) <- c('lastname','firstname','club','position','basesalary','totalcompensation')
salaries21 <- salaries21 %>% rename_with( ~ tolower(gsub("_", "", .x, fixed = TRUE)))
salaries21$clubgrouped <- NULL
salaries21$totalcompensation
salaries21$totalcompensation <- as.numeric(gsub('[$,]', '', salaries21$totalcompensation))
salaries21$basesalary <- as.numeric(gsub('[$,]', '', salaries21$basesalary))
unique(salaries21$position)
oldValue <- c("M","D","F","D-M","M-F","GK","F-M","M-D")
newValue <- c("Midfielder","Defender","Forward","Defender","Midfielder","Goalkeeper","Forward","Midfielder")
salaries21$position <- plyr::mapvalues(salaries21$position, oldValue, newValue)
salaries21$fullname <- paste(salaries21$firstname,salaries21$lastname)
salaries21$season <- 2021
salaries <- rbind(salaries,salaries21)
getwd()
save(salaries, file = "data/salaries.RData")
rMLS::salaries
help(rMLS)
??rMLS
library(rMLS)
??player_stats
playerid_lookup('Vela')
playerid_lookup(name='Vela')
df <- player_stats(id ='e0cd04e0')
head(df)
head(df,1)
library(devtools)
install_github("ryang73/rMLS")
??player_stats
??playerid_lookup
devtools::document()
library(devtools)
install_github("ryang73/rMLS")
library(devtools)
install_github("ryang73/rMLS")
??player_stats
library(rMLS)
??player_stats
??playerid_lookup
library(rMLS)
??player_stats
??box_scores
player_stats(id ='e0cd04e0')
devtools::document()
library(devtools)
install_github("ryang73/rMLS")
??player_stats
??box_scores
devtools::document()
library(devtools)
install_github("ryang73/rMLS")
devtools::document()
library(devtools)
install_github("ryang73/rMLS")
df <- rMLS::fixtures(start_season = 2021)
View(df)
devtools::document()
devtools::install_github("ryang73/rMLS")
devtools::install_github("ryang73/rMLS")
df <- rMLS::fixtures(start_season = 2021)
View(df)
??fixtures
devtools::document()
devtools::install_github("ryang73/rMLS")
df <- rMLS::fixtures(start_season = 2021)
View(df)
usethis::use_pkgdown()
pkgdown::build_site()
??fixtures
gc()
gc()
devtools::document()
library(rMLS)
library(tidyverse)
reticulate::repl_python()
market <-  reticulate::py$market
View(market)
market$capture_time <- lubridate::ymd_hms(market$capture_time,tz = "America/New_York" )
market$Date <- lubridate::as_date(market$event_start)
market$away_team <- dplyr::recode(market$away_team, "HOU Dynamo" = "Houston Dynamo",
"SEA Sounders"="Seattle Sounders FC",
"CF Montreal"="CF Montreal",
"ORL City SC"="Orlando City SC",
"Los Angeles FC"="Los Angeles FC",
"FC Dallas"="FC Dallas",
"NY Red Bulls"="New York Red Bulls",
"DC United"="D.C. United",
"Nashville"="Nashville SC",
"CHI Fire"="Chicago Fire FC",
"Miami"="Inter Miami CF",
"COL Crew"="Columbus Crew SC" ,
"VAN Whitecaps FC"="Vancouver Whitecaps FC",
"Sporting KC"="Sporting Kansas City",
"NYCFC"="New York City FC",
"Toronto FC"="Toronto FC",
"SJ Earthquakes"="San Jose Earthquakes",
"MIN United"="Minnesota United FC",
"Atlanta"="Atlanta United FC",
"NE Revolution"="New England Revolution",
"PHI Union"="Philadelphia Union",
"COL Rapids"="Colorado Rapids",
"POR Timbers"="Portland Timbers",
"LA Galaxy"="LA Galaxy",
"Real Salt Lake"="Real Salt Lake",
"FC Cincinnati"="FC Cincinnati",
"Austin FC"="Austin FC",
"Montreal"="CF Montreal",
"KC Wizards"="Sporting Kansas City",
"MetroStars"="New York Red Bulls",
"Dallas"="FC Dallas",
"KC Wiz"="Sporting Kansas City")
market$home_team <- dplyr::recode(market$home_team, "HOU Dynamo" = "Houston Dynamo",
"SEA Sounders"="Seattle Sounders FC",
"CF Montreal"="CF Montreal",
"ORL City SC"="Orlando City SC",
"Los Angeles FC"="Los Angeles FC",
"FC Dallas"="FC Dallas",
"NY Red Bulls"="New York Red Bulls",
"DC United"="D.C. United",
"Nashville"="Nashville SC",
"CHI Fire"="Chicago Fire FC",
"Miami"="Inter Miami CF",
"COL Crew"="Columbus Crew SC" ,
"VAN Whitecaps FC"="Vancouver Whitecaps FC",
"Sporting KC"="Sporting Kansas City",
"NYCFC"="New York City FC",
"Toronto FC"="Toronto FC",
"SJ Earthquakes"="San Jose Earthquakes",
"MIN United"="Minnesota United FC",
"Atlanta"="Atlanta United FC",
"NE Revolution"="New England Revolution",
"PHI Union"="Philadelphia Union",
"COL Rapids"="Colorado Rapids",
"POR Timbers"="Portland Timbers",
"LA Galaxy"="LA Galaxy",
"Real Salt Lake"="Real Salt Lake",
"FC Cincinnati"="FC Cincinnati",
"Austin FC"="Austin FC",
"Montreal"="CF Montreal",
"KC Wizards"="Sporting Kansas City",
"MetroStars"="New York Red Bulls",
"Dallas"="FC Dallas",
"KC Wiz"="Sporting Kansas City")
load("~/rProjects/rMLS/data/current_odds.RData")
View(market)
View(current_odds)
market <- current_odds
save(current_odds, file = "data/current_odds.RData")
load("~/rProjects/rMLS/data/current_odds.RData")
View(current_odds)
library(rMLS)
library(tidyverse)
reticulate::repl_python()
market <-  reticulate::py$market
market$capture_time <- lubridate::ymd_hms(market$capture_time,tz = "America/New_York" )
market$Date <- lubridate::as_date(market$event_start)
market$away_team <- dplyr::recode(market$away_team, "HOU Dynamo" = "Houston Dynamo",
"SEA Sounders"="Seattle Sounders FC",
"CF Montreal"="CF Montreal",
"ORL City SC"="Orlando City SC",
"Los Angeles FC"="Los Angeles FC",
"FC Dallas"="FC Dallas",
"NY Red Bulls"="New York Red Bulls",
"DC United"="D.C. United",
"Nashville"="Nashville SC",
"CHI Fire"="Chicago Fire FC",
"Miami"="Inter Miami CF",
"COL Crew"="Columbus Crew SC" ,
"VAN Whitecaps FC"="Vancouver Whitecaps FC",
"Sporting KC"="Sporting Kansas City",
"NYCFC"="New York City FC",
"Toronto FC"="Toronto FC",
"SJ Earthquakes"="San Jose Earthquakes",
"MIN United"="Minnesota United FC",
"Atlanta"="Atlanta United FC",
"NE Revolution"="New England Revolution",
"PHI Union"="Philadelphia Union",
"COL Rapids"="Colorado Rapids",
"POR Timbers"="Portland Timbers",
"LA Galaxy"="LA Galaxy",
"Real Salt Lake"="Real Salt Lake",
"FC Cincinnati"="FC Cincinnati",
"Austin FC"="Austin FC",
"Montreal"="CF Montreal",
"KC Wizards"="Sporting Kansas City",
"MetroStars"="New York Red Bulls",
"Dallas"="FC Dallas",
"KC Wiz"="Sporting Kansas City")
market$home_team <- dplyr::recode(market$home_team, "HOU Dynamo" = "Houston Dynamo",
"SEA Sounders"="Seattle Sounders FC",
"CF Montreal"="CF Montreal",
"ORL City SC"="Orlando City SC",
"Los Angeles FC"="Los Angeles FC",
"FC Dallas"="FC Dallas",
"NY Red Bulls"="New York Red Bulls",
"DC United"="D.C. United",
"Nashville"="Nashville SC",
"CHI Fire"="Chicago Fire FC",
"Miami"="Inter Miami CF",
"COL Crew"="Columbus Crew SC" ,
"VAN Whitecaps FC"="Vancouver Whitecaps FC",
"Sporting KC"="Sporting Kansas City",
"NYCFC"="New York City FC",
"Toronto FC"="Toronto FC",
"SJ Earthquakes"="San Jose Earthquakes",
"MIN United"="Minnesota United FC",
"Atlanta"="Atlanta United FC",
"NE Revolution"="New England Revolution",
"PHI Union"="Philadelphia Union",
"COL Rapids"="Colorado Rapids",
"POR Timbers"="Portland Timbers",
"LA Galaxy"="LA Galaxy",
"Real Salt Lake"="Real Salt Lake",
"FC Cincinnati"="FC Cincinnati",
"Austin FC"="Austin FC",
"Montreal"="CF Montreal",
"KC Wizards"="Sporting Kansas City",
"MetroStars"="New York Red Bulls",
"Dallas"="FC Dallas",
"KC Wiz"="Sporting Kansas City")
current_odds <- market
save(current_odds, file = "data/current_odds.RData")
library(rMLS)
library(tidyverse)
reticulate::repl_python()
market <-  reticulate::py$market
market$capture_time <- lubridate::ymd_hms(market$capture_time,tz = "America/New_York" )
market$Date <- lubridate::as_date(market$event_start)
market$away_team <- dplyr::recode(market$away_team, "HOU Dynamo" = "Houston Dynamo",
"SEA Sounders"="Seattle Sounders FC",
"CF Montreal"="CF Montreal",
"ORL City SC"="Orlando City SC",
"Los Angeles FC"="Los Angeles FC",
"FC Dallas"="FC Dallas",
"NY Red Bulls"="New York Red Bulls",
"DC United"="D.C. United",
"Nashville"="Nashville SC",
"CHI Fire"="Chicago Fire FC",
"Miami"="Inter Miami CF",
"COL Crew"="Columbus Crew SC" ,
"VAN Whitecaps FC"="Vancouver Whitecaps FC",
"Sporting KC"="Sporting Kansas City",
"NYCFC"="New York City FC",
"Toronto FC"="Toronto FC",
"SJ Earthquakes"="San Jose Earthquakes",
"MIN United"="Minnesota United FC",
"Atlanta"="Atlanta United FC",
"NE Revolution"="New England Revolution",
"PHI Union"="Philadelphia Union",
"COL Rapids"="Colorado Rapids",
"POR Timbers"="Portland Timbers",
"LA Galaxy"="LA Galaxy",
"Real Salt Lake"="Real Salt Lake",
"FC Cincinnati"="FC Cincinnati",
"Austin FC"="Austin FC",
"Montreal"="CF Montreal",
"KC Wizards"="Sporting Kansas City",
"MetroStars"="New York Red Bulls",
"Dallas"="FC Dallas",
"KC Wiz"="Sporting Kansas City")
market$home_team <- dplyr::recode(market$home_team, "HOU Dynamo" = "Houston Dynamo",
"SEA Sounders"="Seattle Sounders FC",
"CF Montreal"="CF Montreal",
"ORL City SC"="Orlando City SC",
"Los Angeles FC"="Los Angeles FC",
"FC Dallas"="FC Dallas",
"NY Red Bulls"="New York Red Bulls",
"DC United"="D.C. United",
"Nashville"="Nashville SC",
"CHI Fire"="Chicago Fire FC",
"Miami"="Inter Miami CF",
"COL Crew"="Columbus Crew SC" ,
"VAN Whitecaps FC"="Vancouver Whitecaps FC",
"Sporting KC"="Sporting Kansas City",
"NYCFC"="New York City FC",
"Toronto FC"="Toronto FC",
"SJ Earthquakes"="San Jose Earthquakes",
"MIN United"="Minnesota United FC",
"Atlanta"="Atlanta United FC",
"NE Revolution"="New England Revolution",
"PHI Union"="Philadelphia Union",
"COL Rapids"="Colorado Rapids",
"POR Timbers"="Portland Timbers",
"LA Galaxy"="LA Galaxy",
"Real Salt Lake"="Real Salt Lake",
"FC Cincinnati"="FC Cincinnati",
"Austin FC"="Austin FC",
"Montreal"="CF Montreal",
"KC Wizards"="Sporting Kansas City",
"MetroStars"="New York Red Bulls",
"Dallas"="FC Dallas",
"KC Wiz"="Sporting Kansas City")
View(market)
current_odds <- market
save(current_odds, file = "data/current_odds.RData")
library(rMLS)
library(tidyverse)
from sshtunnel import SSHTunnelForwarder
reticulate::repl_python()
market <-  reticulate::py$market
market$capture_time <- lubridate::ymd_hms(market$capture_time,tz = "America/New_York" )
market$Date <- lubridate::as_date(market$event_start)
market$away_team <- dplyr::recode(market$away_team, "HOU Dynamo" = "Houston Dynamo",
"SEA Sounders"="Seattle Sounders FC",
"CF Montreal"="CF Montreal",
"ORL City SC"="Orlando City SC",
"Los Angeles FC"="Los Angeles FC",
"FC Dallas"="FC Dallas",
"NY Red Bulls"="New York Red Bulls",
"DC United"="D.C. United",
"Nashville"="Nashville SC",
"CHI Fire"="Chicago Fire FC",
"Miami"="Inter Miami CF",
"COL Crew"="Columbus Crew SC" ,
"VAN Whitecaps FC"="Vancouver Whitecaps FC",
"Sporting KC"="Sporting Kansas City",
"NYCFC"="New York City FC",
"Toronto FC"="Toronto FC",
"SJ Earthquakes"="San Jose Earthquakes",
"MIN United"="Minnesota United FC",
"Atlanta"="Atlanta United FC",
"NE Revolution"="New England Revolution",
"PHI Union"="Philadelphia Union",
"COL Rapids"="Colorado Rapids",
"POR Timbers"="Portland Timbers",
"LA Galaxy"="LA Galaxy",
"Real Salt Lake"="Real Salt Lake",
"FC Cincinnati"="FC Cincinnati",
"Austin FC"="Austin FC",
"Montreal"="CF Montreal",
"KC Wizards"="Sporting Kansas City",
"MetroStars"="New York Red Bulls",
"Dallas"="FC Dallas",
"KC Wiz"="Sporting Kansas City")
market$home_team <- dplyr::recode(market$home_team, "HOU Dynamo" = "Houston Dynamo",
"SEA Sounders"="Seattle Sounders FC",
"CF Montreal"="CF Montreal",
"ORL City SC"="Orlando City SC",
"Los Angeles FC"="Los Angeles FC",
"FC Dallas"="FC Dallas",
"NY Red Bulls"="New York Red Bulls",
"DC United"="D.C. United",
"Nashville"="Nashville SC",
"CHI Fire"="Chicago Fire FC",
"Miami"="Inter Miami CF",
"COL Crew"="Columbus Crew SC" ,
"VAN Whitecaps FC"="Vancouver Whitecaps FC",
"Sporting KC"="Sporting Kansas City",
"NYCFC"="New York City FC",
"Toronto FC"="Toronto FC",
"SJ Earthquakes"="San Jose Earthquakes",
"MIN United"="Minnesota United FC",
"Atlanta"="Atlanta United FC",
"NE Revolution"="New England Revolution",
"PHI Union"="Philadelphia Union",
"COL Rapids"="Colorado Rapids",
"POR Timbers"="Portland Timbers",
"LA Galaxy"="LA Galaxy",
"Real Salt Lake"="Real Salt Lake",
"FC Cincinnati"="FC Cincinnati",
"Austin FC"="Austin FC",
"Montreal"="CF Montreal",
"KC Wizards"="Sporting Kansas City",
"MetroStars"="New York Red Bulls",
"Dallas"="FC Dallas",
"KC Wiz"="Sporting Kansas City")
current_odds <- market
save(current_odds, file = "data/current_odds.RData")
library(rMLS)
library(tidyverse)
reticulate::repl_python()
